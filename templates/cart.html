{% extends "base.html" %}

{% block title %}Shopping Cart - U.S ATELIER{% endblock %}

{% block content %}
    <div class="cart-container">
        <h1 style="font-size: 2rem; margin-bottom: 2rem; font-weight: 400;">Shopping Cart</h1>

        <div id="cart-content">
            <!-- Cart items loaded by JavaScript -->
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    async function renderCart() {
        const items = CartModule.items;

        if (items.length === 0) {
            document.getElementById('cart-content').innerHTML = `
                <div class="cart-empty">
                    <p>Your cart is empty</p>
                    <a href="/shop" class="btn" style="margin-top: 1rem;">Continue Shopping</a>
                </div>
            `;
            return;
        }

        const cartHTML = `
            <div class="cart-items">
                ${items.map(item => `
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="/static/images/${item.image}" 
                                 alt="${item.name}"
                                 onerror="this.src='/static/images/placeholder.svg'">
                        </div>
                        <div class="cart-item-details">
                            <h3>${item.name}</h3>
                            <div class="cart-item-meta">Size: ${item.size}</div>
                            <div class="cart-item-meta">$${item.price}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="margin-bottom: 1rem;">
                                <button style="width: 30px; height: 30px; border: 1px solid var(--border-color); background: transparent; color: var(--primary-light); cursor: pointer;" onclick="CartModule.updateQuantity('${item.id}', '${item.size}', ${item.quantity - 1})">-</button>
                                <input type="text" value="${item.quantity}" readonly style="width: 40px; text-align: center; background: transparent; border: none; color: var(--primary-light);">
                                <button style="width: 30px; height: 30px; border: 1px solid var(--border-color); background: transparent; color: var(--primary-light); cursor: pointer;" onclick="CartModule.updateQuantity('${item.id}', '${item.size}', ${item.quantity + 1})">+</button>
                            </div>
                            <button onclick="CartModule.removeFromCart('${item.id}')" style="background: none; border: none; color: #888; cursor: pointer; text-decoration: underline; font-size: 0.85rem;">Remove</button>
                            <div style="margin-top: 0.5rem; font-weight: 600;">
                                $${(item.price * item.quantity).toFixed(2)}
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>

            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>$${CartModule.getTotal().toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Shipping</span>
                    <span>$15.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total</span>
                    <span>$${(CartModule.getTotal() + 15).toFixed(2)}</span>
                </div>
                <a href="/checkout" class="btn checkout-btn">Proceed to Checkout</a>
                <a href="/shop" class="btn checkout-btn" style="background-color: transparent;">Continue Shopping</a>
            </div>
        `;

        document.getElementById('cart-content').innerHTML = cartHTML;
    }

    document.addEventListener('DOMContentLoaded', () => {
        CartModule.loadCart().then(() => {
            renderCart();
        });
    });

    // Update cart when items change
    const observer = setInterval(() => {
        renderCart();
    }, 100);
</script>
{% endblock %}
